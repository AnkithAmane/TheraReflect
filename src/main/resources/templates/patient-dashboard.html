<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard - TheraReflect</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">TheraReflect</a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3">Welcome, <span th:text="${patient.name}"></span>!</span>
                <a class="nav-link" href="/logout">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="row g-4">
            <div class="col-lg-3 col-md-4">
                <!-- Sidebar -->
                <div class="dashboard-sidebar">
                    <div class="card">
                        <div class="card-header">
                            <h5><i class="bi bi-compass me-2"></i>Navigation</h5>
                        </div>
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action active">Dashboard</a>
                            <a href="#" class="list-group-item list-group-item-action">My Journal</a>
                            <a href="#" class="list-group-item list-group-item-action">Find Therapists</a>
                            <a href="#" class="list-group-item list-group-item-action">My Appointments</a>
                            <a href="#" class="list-group-item list-group-item-action" onclick="toggleChatbox()">
                                <i class="bi bi-chat-dots me-2"></i>Chat Assistant
                            </a>
                            <a href="#" class="list-group-item list-group-item-action">Messages</a>
                            <a href="#" class="list-group-item list-group-item-action">Profile Settings</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-9 col-md-8">
                <!-- Main Content -->
                <div class="row">
                    <div class="col-12">
                        <div class="welcome-header mb-4">
                            <h2 class="display-6 text-primary"><i class="bi bi-heart-pulse me-3"></i>Patient
                                Dashboard</h2>
                            <p class="lead text-muted">Welcome to your personal mental health journey</p>
                        </div>
                    </div>
                </div>

                <div class="row g-4 mb-4">
                    <!-- Quick Actions -->
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">
                                    <i class="bi bi-journal-text text-primary me-2"></i> Quick Journal Entry
                                </h5>
                                <p class="card-text flex-grow-1">Capture your thoughts and feelings right now.</p>
                                <a href="#" class="btn btn-primary mt-auto">Start Writing</a>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">
                                    <i class="bi bi-person-heart text-success me-2"></i> Find a Therapist
                                </h5>
                                <p class="card-text flex-grow-1">Browse and connect with licensed mental health
                                    professionals.</p>
                                <a href="#" class="btn btn-success mt-auto">Browse Therapists</a>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">
                                    <i class="bi bi-chat-dots-fill text-info me-2"></i> AI Mental Health Assistant
                                </h5>
                                <p class="card-text flex-grow-1">Get instant support and guidance from our AI assistant.
                                </p>
                                <button class="btn btn-info mt-auto" onclick="toggleChatbox()">Start Chat</button>
                            </div>
                        </div>
                    </div>
                </div> <!-- Recent Activity & Appointments -->
                <div class="row g-4">
                    <!-- Recent Activity -->
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-journal-bookmark text-primary me-2"></i>Recent Journal Entries
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="text-center py-4">
                                    <i class="bi bi-journal-plus text-muted" style="font-size: 3rem;"></i>
                                    <p class="text-muted mt-3 mb-4">No journal entries yet. Start writing to track your
                                        mental health journey!</p>
                                    <a href="#" class="btn btn-primary">Create Your First Entry</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Appointments -->
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-calendar-check text-success me-2"></i>Upcoming Appointments
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="text-center py-4">
                                    <i class="bi bi-calendar-plus text-muted" style="font-size: 3rem;"></i>
                                    <p class="text-muted mt-3 mb-4">No upcoming appointments scheduled.</p>
                                    <a href="#" class="btn btn-success">Schedule an Appointment</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Information -->
                <div class="row mt-5">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="bi bi-person-circle text-info me-2"></i>Your Profile
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Name</label>
                                            <p class="h6" th:text="${patient.name}">John Doe</p>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Email</label>
                                            <p class="h6" th:text="${patient.email}">john.doe@email.com</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Member Since</label>
                                            <p class="h6">Today</p>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Status</label>
                                            <p class="h6"><span
                                                    class="badge bg-success-subtle text-success">Active</span></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center mt-4">
                                    <a href="#" class="btn btn-outline-primary me-2">Edit Profile</a>
                                    <a href="#" class="btn btn-outline-secondary">Privacy Settings</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chatbox -->
            <div class="chatbox-container" id="chatboxContainer">
                <div class="chatbox-header" onclick="toggleChatbox()">
                    <i class="bi bi-chat-dots"></i>
                    <span>Mental Health Assistant</span>
                    <button type="button" class="btn-close-chat" onclick="toggleChatbox()">
                        <i class="bi bi-dash-lg" id="chatToggleIcon"></i>
                    </button>
                </div>
                <div class="chatbox-body" id="chatboxBody">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message bot-message">
                            <div class="message-content">
                                <p>Hello! I'm your mental health assistant. How are you feeling today?</p>
                                <span class="message-time">Just now</span>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..."
                            onkeypress="handleKeyPress(event)">
                        <button class="chat-send-btn" onclick="sendMessage()">
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Toggle Button -->
            <div class="chat-toggle-btn" onclick="toggleChatbox()" id="chatToggleBtn">
                <i class="bi bi-chat-dots-fill"></i>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

            <script>
                let chatboxOpen = false;

                function toggleChatbox() {
                    const chatbox = document.getElementById('chatboxContainer');
                    const toggleBtn = document.getElementById('chatToggleBtn');
                    const toggleIcon = document.getElementById('chatToggleIcon');

                    if (chatboxOpen) {
                        chatbox.style.transform = 'translateY(100%)';
                        toggleBtn.style.display = 'block';
                        toggleIcon.className = 'bi bi-dash-lg';
                        chatboxOpen = false;
                    } else {
                        chatbox.style.transform = 'translateY(0)';
                        toggleBtn.style.display = 'none';
                        toggleIcon.className = 'bi bi-x-lg';
                        chatboxOpen = true;
                    }
                }

                function sendMessage() {
                    const input = document.getElementById('chatInput');
                    const message = input.value.trim();

                    if (message) {
                        addMessage(message, 'user');
                        input.value = '';

                        // Simulate bot response
                        setTimeout(() => {
                            generateBotResponse(message);
                        }, 1000);
                    }
                }

                function addMessage(message, sender) {
                    const chatMessages = document.getElementById('chatMessages');
                    const messageDiv = document.createElement('div');
                    const currentTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                    messageDiv.className = `message ${sender}-message`;
                    messageDiv.innerHTML = `
                <div class="message-content">
                    <p>${message}</p>
                    <span class="message-time">${currentTime}</span>
                </div>
            `;

                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                function generateBotResponse(userMessage) {
                    const responses = {
                        'hello': 'Hello! How can I support you today?',
                        'sad': 'I understand you might be feeling sad. Would you like to talk about what\'s bothering you?',
                        'anxious': 'Anxiety can be overwhelming. Let\'s try some breathing exercises. Take a deep breath in for 4 counts...',
                        'help': 'I\'m here to provide mental health support. You can talk to me about your feelings, or I can suggest coping strategies.',
                        'therapy': 'Therapy can be very helpful. Would you like me to help you find a therapist in your area?',
                        'default': 'Thank you for sharing. Remember, it\'s important to acknowledge your feelings. Is there anything specific you\'d like to discuss?'
                    };

                    let response = responses['default'];
                    const lowerMessage = userMessage.toLowerCase();

                    if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                        response = responses['hello'];
                    } else if (lowerMessage.includes('sad') || lowerMessage.includes('depression')) {
                        response = responses['sad'];
                    } else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worried')) {
                        response = responses['anxious'];
                    } else if (lowerMessage.includes('help')) {
                        response = responses['help'];
                    } else if (lowerMessage.includes('therapy') || lowerMessage.includes('therapist')) {
                        response = responses['therapy'];
                    }

                    addMessage(response, 'bot');
                }

                function handleKeyPress(event) {
                    if (event.key === 'Enter') {
                        sendMessage();
                    }
                }

                // Auto-scroll to latest message
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            </script>
</body>

</html>